<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starry Night</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="./index.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rosario:wght@600&display=swap" />
    <style>
        .star {
            position: absolute;
            width: 15px; /* Slightly larger size */
            height: 15px; /* Slightly larger size */
            background-image: url('star.png');
            background-size: cover;
            filter: brightness(1); /* Normal brightness by default */
            transition: transform 0.3s ease, filter 0.3s ease; /* Smooth transition for transform and filter */
            animation: pulse 2s infinite; /* Add pulsing animation */
        }

        .star:hover::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 30px; /* Size of the glow circle */
            height: 30px; /* Size of the glow circle */
            background-color: rgba(255, 255, 255, 0.3); /* Low opacity white color */
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: -1; /* Ensure it appears behind the star */
        }

        .star:hover {
            filter: brightness(1.5); /* Increase brightness on hover */
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(2); /* Increase size more */
            }
        }

        #popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            /* background-color: rgba(0, 0, 0, 0.8); */
            padding: 20px;
            /* border-radius: 10px; */
            /* color: #fff; */
            text-align: center;
            animation: popupTween 0.8s forwards;
            pointer-events: none; /* Disable pointer events during animation */
            /* box-shadow: none; Remove shadow */
        }

        #popup.animated {
            pointer-events: auto; /* Enable pointer events after animation */
        }

        @keyframes popupTween {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            80% {
                transform: translate(-50%, -50%) scale(0.9);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        body {
            opacity: 0;
            animation: fadeIn 1s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <audio id="hoverSound" src="SFX/hover-sound.mp3" preload="auto"></audio>
    <audio id="clickSound" src="SFX/click-sound.mp3" preload="auto"></audio>
    <audio id="backgroundMusic" src="SFX/astral-music.mp3" preload="auto" loop autoplay></audio>

    <canvas id="cursorCanvas"></canvas>

    <div class="navbar">
        <a href="play.html" class="nav-button">Play</a>
        <a href="inventory.html" class="nav-button">Inventory</a>
        <a href="shop.html" class="nav-button">Shop</a>
    </div>

    <div class="vector-parent" id="popup">
        <img class="frame-child" alt="" src="Ellipse 4.svg">
        <img class="frame-item" alt="" src="Ellipse 3.svg">
        <div class="frame-inner"></div>
        <div class="ellipse-div"></div>
        <img class="ellipse-icon" alt="" src="Ellipse 5.svg">
        <div class="frame-child1"></div>
        <div class="frame-child2"></div>
        <div class="alula-australis-wrapper">
            <div class="alula-australis">Alula Australis</div>
        </div>
        <button class="close-btn" onclick="closePopup()">Close</button>
    </div>

    <div id="muteToggle" class="mute-icon" onclick="toggleMute()"></div>

    <script>
        const canvas = document.getElementById('cursorCanvas');
        const ctx = canvas.getContext('2d');
        const trail = [];
        const shootingStars = [];
        const dots = [];
        const stars = [];
        let isMuted = false;
        const maxTrailLength = 20; // Maximum number of points in the trail

        // class Star {
        //     constructor(x, y, popupImage) {
        //         this.x = x;
        //         this.y = y;
        //         this.popupImage = popupImage;
        //     }
        //     // ... existing methods ...
        // }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function drawTrail() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#FFD700';

            const now = Date.now();
            trail.forEach((point, index) => {
                if (now - point.time > 500) {
                    trail.splice(index, 1);
                }
            });

            if (trail.length < 2) return;

            ctx.moveTo(trail[0].x, trail[0].y);

            for (let i = 1; i < trail.length - 2; i++) {
                const xc = (trail[i].x + trail[i + 1].x) / 2;
                const yc = (trail[i].y + trail[i + 1].y) / 2;
                ctx.quadraticCurveTo(trail[i].x, trail[i].y, xc, yc);
            }

            ctx.quadraticCurveTo(
                trail[trail.length - 2].x,
                trail[trail.length - 2].y,
                trail[trail.length - 1].x,
                trail[trail.length - 1].y
            );

            ctx.stroke();

            // Subtle glow at the front of the trail
            if (trail.length > 0) {
                const front = trail[trail.length - 1];
                ctx.beginPath();
                ctx.arc(front.x, front.y, 5, 0, Math.PI * 2); // Smaller glow
                ctx.fillStyle = 'rgba(255, 215, 0, 0.3)'; // More subtle
                ctx.fill();
            }
        }

        function createShootingStar() {
            const direction = Math.random() * Math.PI * 2; // Random direction
            const speed = Math.random() * 3 + 2;
            const star = {
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight,
                speedX: Math.cos(direction) * speed,
                speedY: Math.sin(direction) * speed,
                trail: []
            };
            shootingStars.push(star);
        }

        function drawShootingStars() {
            shootingStars.forEach(star => {
                star.x += star.speedX;
                star.y += star.speedY;

                star.trail.push({ x: star.x, y: star.y, time: Date.now() });

                ctx.beginPath();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)'; // Brighter line
                ctx.lineWidth = 2; // Slightly thicker line

                star.trail.forEach((point, index) => {
                    if (Date.now() - point.time > 500) {
                        star.trail.splice(index, 1);
                    }
                });

                if (star.trail.length > 0) {
                    ctx.moveTo(star.trail[0].x, star.trail[0].y);
                    for (let i = 1; i < star.trail.length; i++) {
                        ctx.lineTo(star.trail[i].x, star.trail[i].y);
                    }
                }

                ctx.stroke();

                // Less glow for shooting star
                ctx.beginPath();
                ctx.arc(star.x, star.y, 3, 0, Math.PI * 2); // Smaller glow
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)'; // Less intense
                ctx.fill();
            });
        }

        function updateTrail() {
            drawTrail();
            drawShootingStars();
            requestAnimationFrame(updateTrail);
        }

        function createDot(x, y) {
            const dot = document.createElement('div');
            dot.className = 'dot';
            dot.style.left = `${x}px`;
            dot.style.top = `${y}px`;
            dot.style.backgroundColor = `rgba(255, 255, 255, ${Math.random() * 0.3 + 0.2})`; // Decrease opacity
            document.body.appendChild(dot);
            dots.push({ element: dot, x, y, offsetX: Math.random() * 0.05 - 0.025, offsetY: Math.random() * 0.05 - 0.025 });
        }

        function moveDots() {
            dots.forEach(dot => {
                dot.x += dot.offsetX;
                dot.y += dot.offsetY;
                if (dot.x < 0 || dot.x > window.innerWidth) dot.offsetX *= -1;
                if (dot.y < 0 || dot.y > window.innerHeight) dot.offsetY *= -1;
                dot.element.style.left = `${dot.x}px`;
                dot.element.style.top = `${dot.y}px`;
            });
        }

        function createStar(x, y, popupImage = 'Images/Frame 3.png') {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = `${x}px`;
            star.style.top = `${y}px`;
            star.style.backgroundImage = "url('Images/star.png')";
            star.style.backgroundSize = 'cover';
            star.style.width = '45px';
            star.style.height = '45px';
            star.dataset.popupImage = popupImage;

            // Apply a random animation delay
            const randomDelay = Math.random() * 2; // Random delay between 0 and 2 seconds
            star.style.animationDelay = `${randomDelay}s`;

            star.onclick = () => {
                playClickSound();
                showPopup(star.dataset.popupImage);
            };
            star.onmouseover = () => playHoverSound();
            star.onmouseout = () => stopHoverSound();
            document.body.appendChild(star);
            stars.push(star);
        }

        function generateDots(count) {
            for (let i = 0; i < count; i++) {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                createDot(x, y);
            }
        }
        

        function generateConstellations() {
            const constellations = {
                'Ursa Major': [
                    { x: 0.18, y: 0.765, popupImage: 'Images/Frame 3.png'}, // Alula Australis
                    { x: 0.23, y: 0.777, popupImage: 'Images/Alula Borealis.png'}, // Alula Borealis
                    { x: 0.59, y: 0.60, popupImage: 'Images/X.png'}, // X
                    { x: 0.78, y: 0.55, popupImage: 'Images/Phecda.png'}, // Phecda
                    { x: 0.90, y: 0.44, popupImage: 'Images/Megrez.png'}, //Megrez
                    { x: 0.92, y: 0.28, popupImage: 'Images/Alioth.png'}, // Alioth
                    { x: 0.96, y: 0.15, popupImage: 'Images/Alkaid.png'}, // Alkaid
                    { x: 1.05, y: 0.67, popupImage: 'Images/Dubhe.png'}, // Dubhe
                    { x: 0.87, y: 0.72, popupImage: 'Images/h.png'}, // h
                    { x: 1.20, y: 0.89, popupImage: 'Images/Muscida.png'}, // Muscida
                    { x: 1.265, y: 1.10, popupImage: 'Images/Upsilon.png'}, // Upsilon
                    { x: 1.00, y: 0.88, popupImage: 'Images/Merak.png'}, // Merak
                    { x: 0.85, y: 1.05, popupImage: 'Images/Theta.png'}, // Theta
                    { x: 0.87, y: 1.2, popupImage: 'Images/Talitha.png'}, // Talitha
                    { x: 0.83, y: 1.2, popupImage: 'Images/Alkaphrah.png'}, // Alkaphrah
                    { x: 0.54, y: .78, popupImage: 'Images/Psi.png'}, // Psi
                    { x: 0.53, y: 1, popupImage: 'Images/Tania Borealis.png'}, // Tania Borealis
                    { x: 0.58, y: 0.98, popupImage: 'Images/Tania Australis.png'} // Tania Australis

                ],
                'Pegasus': [
                    { x: 2.0, y: 1.05},
                    { x: 1.97, y: 0.80},
                    { x: 2.4, y: 1.075},
                    { x: 2.38, y:0.95},
                    { x: 2.62, y: 1.09},
                    { x: 2.58, y: 1},
                    { x: 2.582, y: 0.50},
                    { x: 2.54, y: 0.49},
                    { x: 2.49, y: 0.44},
                    { x: 2.80, y: 1.02},
                    { x: 3, y: 1.30},
                    { x: 3.02, y: 0.70},
                    { x: 3.022, y: 0.52},
                    { x: 3.28, y: 0.42},
                    { x: 3.20, y: 0.715},
                    { x: 3.40, y: 1.06},
                    { x: 3.60, y: 1.035}
                ]
            };

            const scaleFactor = 500; // Adjust scale for constellation size

            Object.values(constellations).forEach(pattern => {
                pattern.forEach(point => {
                    createStar(point.x * scaleFactor, point.y * scaleFactor, point.popupImage);
                });
            });
        }

        function moveElements(event) {
            trail.push({ x: event.clientX, y: event.clientY, time: Date.now() });
            const dots = document.querySelectorAll('.dot');
            dots.forEach(dot => {
                const rect = dot.getBoundingClientRect();
                const dotCenterX = rect.left + rect.width / 2;
                const dotCenterY = rect.top + rect.height / 2;
                const distance = Math.hypot(event.clientX - dotCenterX, event.clientY - dotCenterY);

                if (distance < 100) { // Move farther away for dots
                    const moveX = (dotCenterX - event.clientX) * 0.1;
                    const moveY = (dotCenterY - event.clientY) * 0.1;
                    dot.style.transform = `translate(${moveX}px, ${moveY}px)`;
                } else {
                    dot.style.transform = 'translate(0, 0)';
                }
            });
        }

        function showPopup(imagePath) {
            const popup = document.getElementById('popup');
            popup.innerHTML = '';

            const popupImage = document.createElement('img');
            popupImage.src = imagePath;
            popupImage.style.width = 'auto';
            popupImage.style.height = 'auto';
            popupImage.style.maxWidth = '100%';
            popupImage.style.display = 'block';
            popupImage.style.margin = '0 auto';

            popup.appendChild(popupImage);

            const closeButton = document.createElement('button');
            closeButton.className = 'close-btn';
            closeButton.innerText = 'Close';
            closeButton.onclick = closePopup;
            popup.appendChild(closeButton);

            // Reset transform before displaying
            popup.style.transform = 'translate(-50%, -50%) scale(0)';
            popup.style.display = 'block';
            popup.style.animation = 'popupTween 0.8s forwards';

            // Add a class to enable pointer events after animation
            setTimeout(() => {
                popup.classList.add('animated');
            }, 800); // Match the duration of the animation
        }

        function closePopup() {
            const popup = document.getElementById('popup');
            popup.style.display = 'none';
            popup.classList.remove('animated'); // Remove class when closing
        }

        function playHoverSound() {
            const hoverSound = document.getElementById('hoverSound');
            hoverSound.play();
        }

        function stopHoverSound() {
            const hoverSound = document.getElementById('hoverSound');
            hoverSound.pause();
            hoverSound.currentTime = 0;
        }

        function playClickSound() {
            const clickSound = document.getElementById('clickSound');
            clickSound.play();
        }

        function playBackgroundMusic() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            backgroundMusic.play();
        }

        function toggleMute() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            isMuted = !isMuted;
            backgroundMusic.muted = isMuted;
            document.getElementById('muteToggle').classList.toggle('muted', isMuted);
        }

        function navigateTo(url) {
            document.body.style.animation = 'fadeOut 1s forwards';
            setTimeout(() => {
                window.location.href = url;
            }, 1000);
        }

        window.onload = () => {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            generateDots(500); // More dots for a starry effect
            generateConstellations(); // Generate fixed constellations
            document.addEventListener('mousemove', moveElements);
            setInterval(createShootingStar, 1000); // Create a shooting star every 1 second
            updateTrail();
            playBackgroundMusic(); // Ensure background music plays on load
        };
    </script>
</body>
</html>
